# Multimodal RAG System Unification Plan

## Goal
Combine the existing image-based and text-based RAG microservices into a unified multimodal RAG system with a shared MongoDB Atlas backend, unified collection management, a single frontend, and Ollama LLM for all QA.

---

## Step-by-Step Plan

### 1. MongoDB Atlas Schema & Integration
- **Design a schema** for storing both visual and text embeddings, with metadata and weak links between modalities.
- **Acceptance Criteria:**
  - Schema supports both image and text chunks, with collection, type, and linking metadata.
  - Both microservices can connect to MongoDB Atlas and perform CRUD operations on the new schema.

### 2. Collection Management Refactor
- **Refactor collection management** to use MongoDB Atlas for creating, listing, and deleting collections.
- **Acceptance Criteria:**
  - Collections are created, listed, and deleted in MongoDB Atlas.
  - Unified collection logic is accessible to both microservices.

### 3. Microservice Storage Refactor
- **Update both microservices** (image and text) to use MongoDB Atlas for all embedding storage and retrieval.
- **Acceptance Criteria:**
  - All embeddings and metadata are stored and retrieved from MongoDB Atlas.
  - No use of SQLite or ChromaDB remains.

### 4. Unified Frontend (ui.py)
- **Build a new Streamlit UI** in the main `rag` folder for multimodal upload, collection management, and querying.
- **Acceptance Criteria:**
  - Users can create/select collections, upload images/docs, and query both modalities.
  - Results show both text and image matches, with links between them.

### 5. Unified Entrypoint (main.py)
- **Create a main entrypoint** in the main `rag` folder to orchestrate or proxy both microservices.
- **Acceptance Criteria:**
  - Both microservices can be started or connected to from this entrypoint.
  - Health check endpoint is available.

### 6. QA/LLM Unification
- **Switch all QA to use Ollama LLM** for both text and image queries.
- **Acceptance Criteria:**
  - All answers are generated by Ollama LLM.
  - No OpenRouter LLM calls remain.

### 7. Unified .env File
- **Create a single .env** at the root for all config, keys, and URLs.
- **Acceptance Criteria:**
  - All services and frontend read from this .env file.

### 8. Testing
- **Keep unit tests for each microservice.**
- **Add integration tests** for the unified pipeline.
- **Acceptance Criteria:**
  - Unit tests pass for both microservices.
  - Integration tests validate end-to-end multimodal retrieval and QA.

---

## Process
- After each step, acceptance criteria must be met and confirmed before moving to the next step.
- This file will be updated as progress is made and used as a reference for the workflow.
